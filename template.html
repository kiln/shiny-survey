<!DOCTYPE html>
<html>
  <head>
    <!-- Add required Shiny code to the page  -->
    <!-- See https://shiny.rstudio.com/articles/templates.html#complete-web-pages -->
    {{ headContent() }}
    <!-- Add required Bootstrap code to the page  -->
    <!-- See https://shiny.rstudio.com/articles/templates.html#using-bootstrap-components -->
    {{ bootstrapLib() }}
    <meta name="viewport" content="width=device-width, initial-scale=1">
		<style>
			html, body, #chart, iframe {
				height: 100%;
				width: 100%;
				margin: 0;
				border: 0;
			}
      .wrapper {
        margin-left: auto;
        margin-right: auto;
        max-width: 800px;
      }
      @media screen and (max-width: 805px) {
        .wrapper {
          max-width: 80%;
        }
      }
		</style>
    <script src="survey.js"></script>
  </head>
  <body>
    <div class="wrapper">
      <!-- Insert buttons created in ui.R  -->
        {{ year_selector }}
        {{ shape_buttons }}
      <!-- Create container for Flourish API to draw chart in -->
        <div id="chart"></div>
    </div>
    <script>
      // Handler for init message from Shiny server
      Shiny.addCustomMessageHandler("init", function(initial_values) {
        var data = initial_values.data;
        var shape = initial_values.shape;
        var updateSurvey = createSurvey("#chart", data, shape);

        // Handler for updateData message from Shiny server
        Shiny.addCustomMessageHandler("updateData", function(filtered_data) {
          data = filtered_data;
          updateSurvey(data, shape);
        });

        // Handler for updateShape message from Shiny server
        Shiny.addCustomMessageHandler("updateShape", function(new_shape) {
          shape = new_shape;
          updateSurvey(data, shape);
        });
      });
    </script>
  </body>
</html>